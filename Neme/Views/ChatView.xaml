<UserControl x:Class="Neme.Views.ChatView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
               xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:utils="clr-namespace:Neme.Utils"
             xmlns:local="clr-namespace:Neme.Views"
             Height="Auto"
             Width="Auto">
    <UserControl.Resources>
        <DataTemplate x:Key="SentMessageTemplate">
            <Border Background="DodgerBlue" Padding="10" Margin="5" CornerRadius="15" HorizontalAlignment="Right">
                <StackPanel Orientation="Vertical">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Foreground="AntiqueWhite" Text="{Binding SenderName}" FontSize="12" FontWeight="Bold" HorizontalAlignment="Right"/>
                        <TextBlock Foreground="AntiqueWhite" Text="{Binding Timestamp}" FontSize="9" FontStyle="Italic" HorizontalAlignment="Left"/>
                    </StackPanel>

                    <TextBlock Foreground="AntiqueWhite"  Text="{Binding Content}" FontSize="11"/>
                </StackPanel>
            </Border>
        </DataTemplate>
        <DataTemplate x:Key="ReceivedMessageTemplate">
            <Border Background="ForestGreen" Padding="10" CornerRadius="15" Margin="5" HorizontalAlignment="Left">
                <StackPanel Orientation="Vertical">
                   <StackPanel Orientation="Horizontal">
                        <TextBlock Foreground="AntiqueWhite" Text="{Binding SenderName}" FontSize="12" FontWeight="Bold" HorizontalAlignment="Left"/>
                        <TextBlock Foreground="AntiqueWhite" Text="{Binding Timestamp}" FontSize="9" FontStyle="Italic" HorizontalAlignment="Right"/>
                    </StackPanel>

                    <TextBlock Foreground="AntiqueWhite"  Text="{Binding Content}" FontSize="11"/>
                </StackPanel>
            </Border>
        </DataTemplate>
        <utils:ChatBubbleTemplateSelector x:Key="ChatBubbleSelector"
                                          SentMessageTemplate="{StaticResource SentMessageTemplate}"
                                          ReceivedMessageTemplate="{StaticResource ReceivedMessageTemplate}"/>
        
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <ListBox
            ItemsSource="{Binding SelectedPeerMessages}" 
                 Grid.Row="0" Margin="10"
                 Background="Transparent"
                 Foreground="White" ItemTemplateSelector="{StaticResource ChatBubbleSelector}"
                Height="600"
                
            />



        <Grid  Margin="10" Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <!-- Upload Button -->
                <ColumnDefinition Width="*"/>
                <!-- TextBox (Expands) -->
                <ColumnDefinition Width="Auto"/>
                <!-- Send Button -->
            </Grid.ColumnDefinitions>
            <Button Command="{Binding UploadFileCommand}"
                    Grid.Column="0"
                     Width="40"
                    Height="40"
                    VerticalAlignment="Top"
                    Background="DodgerBlue"
                    Foreground="White"
         Style="{StaticResource MaterialDesignFloatingActionButton}"  Margin="0,0,10,0" ToolTip="Send File">
                <materialDesign:PackIcon Kind="Paperclip" Width="24" Height="24"/>
            </Button>
            <TextBox x:Name="MessageTextBox"
                     Grid.Column="1"
                     MinWidth="400"
                      Height="Auto" 
                     MaxHeight="120"
                     AcceptsReturn="True"
                     TextWrapping="Wrap"
                     VerticalScrollBarVisibility="Auto"
                     VerticalAlignment="Center"
                     Text="{Binding NewMessage, Mode=TwoWay}"
                     Background="White" Foreground="Black"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}"/>

            <Button Command="{Binding SendMessageCommand}"
                    Width="40" Height="40" 
                    VerticalAlignment="Top"
                    Grid.Column="2"
                    Background="DodgerBlue" Foreground="White"
                    Style="{StaticResource MaterialDesignFloatingActionButton}" 
                    Margin="10,0,0,0">
                <materialDesign:PackIcon Kind="Send" Width="24" Height="24"/>
            </Button>
            
        </Grid>
    </Grid>
</UserControl>
